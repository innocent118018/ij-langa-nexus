-- First, let's check if customers table exists and add any missing customers
INSERT INTO public.customers (name, user_id, created_at, updated_at) VALUES
('NKUYAHAE HOLDINGS (PTY)LTD', '00000000-0000-0000-0000-000000000001', now(), now()),
('NATHAN N NYANGUWO MEDICAL ORTHOTIST AND PROSTHETIST', '00000000-0000-0000-0000-000000000001', now(), now()),
('Madidi Property Management', '00000000-0000-0000-0000-000000000001', now(), now()),
('TECHLOGIX', '00000000-0000-0000-0000-000000000001', now(), now()),
('KHAYA LAMI TRAVEL AND TOURS', '00000000-0000-0000-0000-000000000001', now(), now()),
('FEZEKA CIVIL ENGINEERING AND CONSTRUCTION', '00000000-0000-0000-0000-000000000001', now(), now()),
('NSIBANDE MHURI TRADING AND PROJEC', '00000000-0000-0000-0000-000000000001', now(), now()),
('Sembo Collective', '00000000-0000-0000-0000-000000000001', now(), now()),
('Chulumanco Lilitha', '00000000-0000-0000-0000-000000000001', now(), now()),
('JO CHILOANE', '00000000-0000-0000-0000-000000000001', now(), now()),
('Sthuthamagade Trading and Projects Cc', '00000000-0000-0000-0000-000000000001', now(), now()),
('JAMA KAMNISI TRADING AND PROJECTS', '00000000-0000-0000-0000-000000000001', now(), now()),
('Global Business Solutions', '00000000-0000-0000-0000-000000000001', now(), now()),
('Suzan Ramapulane', '00000000-0000-0000-0000-000000000001', now(), now()),
('THE NEW ST SAMPSON APOSTOLIC CHURCH', '00000000-0000-0000-0000-000000000001', now(), now()),
('THOKOZA NHLANHLA INVESTMENTS', '00000000-0000-0000-0000-000000000001', now(), now()),
('PRETTY HOPE SMITH', '00000000-0000-0000-0000-000000000001', now(), now()),
('NTANDOSE TRADING AND PROJECTS', '00000000-0000-0000-0000-000000000001', now(), now()),
('YOWGATY', '00000000-0000-0000-0000-000000000001', now(), now()),
('SIPHALI', '00000000-0000-0000-0000-000000000001', now(), now()),
('ORIS POULTRY AND GENERAL TRADING', '00000000-0000-0000-0000-000000000001', now(), now()),
('MDALUKWANE PROJECTS ENTERPRISE', '00000000-0000-0000-0000-000000000001', now(), now()),
('Surprise Tuckshop & General', '00000000-0000-0000-0000-000000000001', now(), now()),
('AZALE COMMUNICATIONS (PTY) LTD', '00000000-0000-0000-0000-000000000001', now(), now()),
('Refithile Agency', '00000000-0000-0000-0000-000000000001', now(), now()),
('FREESTYLE  KITCHEN AND CATERING', '00000000-0000-0000-0000-000000000001', now(), now()),
('THOKOZA SIYAVUMA CONSTRUCTION AND PROJECTS', '00000000-0000-0000-0000-000000000001', now(), now()),
('MANYUNYU LOGISTICS', '00000000-0000-0000-0000-000000000001', now(), now()),
('MABS MEDIA AGENCY', '00000000-0000-0000-0000-000000000001', now(), now()),
('SSL PROJECTS AND SUPPLY', '00000000-0000-0000-0000-000000000001', now(), now())
ON CONFLICT (name) DO NOTHING;

-- Clear existing sales invoices data
TRUNCATE TABLE public.sales_invoices RESTART IDENTITY CASCADE;

-- Insert sales invoices data
INSERT INTO public.sales_invoices (
    user_id, 
    customer_id, 
    invoice_number, 
    issue_date, 
    due_date, 
    subtotal, 
    vat_amount, 
    total_amount, 
    amount_paid,
    balance_due,
    status,
    created_at, 
    updated_at
) VALUES
('00000000-0000-0000-0000-000000000001', (SELECT id FROM customers WHERE name = 'NKUYAHAE HOLDINGS (PTY)LTD' LIMIT 1), '20202616', '2025-09-18', '2025-09-22', 690.00, 103.50, 793.50, 0.00, 793.50, 'Coming due', '2025-09-18 00:00:00+00', now()),
('00000000-0000-0000-0000-000000000001', (SELECT id FROM customers WHERE name = 'NATHAN N NYANGUWO MEDICAL ORTHOTIST AND PROSTHETIST' LIMIT 1), '20202615', '2025-09-11', '2025-09-25', 900.00, 135.00, 1035.00, 1035.00, 0.00, 'Paid in full', '2025-09-11 00:00:00+00', now()),
('00000000-0000-0000-0000-000000000001', (SELECT id FROM customers WHERE name = 'NKUYAHAE HOLDINGS (PTY)LTD' LIMIT 1), '20202614', '2025-09-10', '2025-09-24', 1640.00, 246.00, 1886.00, 1886.00, 0.00, 'Paid in full', '2025-09-10 00:00:00+00', now()),
('00000000-0000-0000-0000-000000000001', (SELECT id FROM customers WHERE name = 'Madidi Property Management' LIMIT 1), '20202612', '2025-09-10', '2025-09-24', 1440.00, 216.00, 1656.00, 1656.00, 0.00, 'Paid in full', '2025-09-10 00:00:00+00', now()),
('00000000-0000-0000-0000-000000000001', (SELECT id FROM customers WHERE name = 'Madidi Property Management' LIMIT 1), '20202613', '2025-09-09', '2025-09-23', 4035.00, 605.25, 4640.25, 4640.25, 0.00, 'Paid in full', '2025-09-09 00:00:00+00', now()),
('00000000-0000-0000-0000-000000000001', (SELECT id FROM customers WHERE name = 'Madidi Property Management' LIMIT 1), '20202611', '2025-09-02', '2025-09-16', 1185.00, 177.75, 1362.75, 1362.75, 0.00, 'Paid in full', '2025-09-02 00:00:00+00', now()),
('00000000-0000-0000-0000-000000000001', (SELECT id FROM customers WHERE name = 'TECHLOGIX' LIMIT 1), '20202610', '2025-09-01', '2025-09-15', 250.00, 37.50, 287.50, 0.00, 287.50, 'Overdue', '2025-09-01 00:00:00+00', now()),
('00000000-0000-0000-0000-000000000001', (SELECT id FROM customers WHERE name = 'Madidi Property Management' LIMIT 1), '20202609', '2025-09-01', '2025-09-15', 1927.00, 289.05, 2216.05, 2216.05, 0.00, 'Paid in full', '2025-09-01 00:00:00+00', now()),
('00000000-0000-0000-0000-000000000001', (SELECT id FROM customers WHERE name = 'KHAYA LAMI TRAVEL AND TOURS' LIMIT 1), '20202608', '2025-08-31', '2025-09-14', 1336.00, 200.40, 1536.40, 1536.40, 0.00, 'Paid in full', '2025-08-31 00:00:00+00', now()),
('00000000-0000-0000-0000-000000000001', (SELECT id FROM customers WHERE name = 'FEZEKA CIVIL ENGINEERING AND CONSTRUCTION' LIMIT 1), '20202607', '2025-08-26', '2025-09-09', 615.00, 92.25, 707.25, 707.25, 0.00, 'Paid in full', '2025-08-26 00:00:00+00', now()),
('00000000-0000-0000-0000-000000000001', (SELECT id FROM customers WHERE name = 'NSIBANDE MHURI TRADING AND PROJEC' LIMIT 1), '20202606', '2025-08-26', '2025-09-09', 0.00, 0.00, 0.00, 0.00, 0.00, 'Paid in full', '2025-08-26 00:00:00+00', now()),
('00000000-0000-0000-0000-000000000001', (SELECT id FROM customers WHERE name = 'Sembo Collective' LIMIT 1), '20202604', '2025-08-01', '2025-08-15', 590.00, 88.50, 678.50, 678.50, 0.00, 'Paid in full', '2025-08-01 00:00:00+00', now()),
('00000000-0000-0000-0000-000000000001', (SELECT id FROM customers WHERE name = 'Chulumanco Lilitha' LIMIT 1), '20202603', '2025-07-31', '2025-08-14', 180.00, 27.00, 207.00, 207.00, 0.00, 'Paid in full', '2025-07-31 00:00:00+00', now()),
('00000000-0000-0000-0000-000000000001', (SELECT id FROM customers WHERE name = 'Chulumanco Lilitha' LIMIT 1), '20202602', '2025-07-23', '2025-08-06', 940.00, 141.00, 1081.00, 1081.00, 0.00, 'Paid in full', '2025-07-23 00:00:00+00', now()),
('00000000-0000-0000-0000-000000000001', (SELECT id FROM customers WHERE name = 'JO CHILOANE' LIMIT 1), '20202601', '2025-07-23', '2025-08-06', 2330.85, 350.13, 2680.98, 2680.98, 0.00, 'Paid in full', '2025-07-23 00:00:00+00', now()),
('00000000-0000-0000-0000-000000000001', (SELECT id FROM customers WHERE name = 'NATHAN N NYANGUWO MEDICAL ORTHOTIST AND PROSTHETIST' LIMIT 1), '20202600', '2025-07-22', '2025-08-05', 2999.00, 449.85, 3448.85, 3448.85, 0.00, 'Paid in full', '2025-07-22 00:00:00+00', now()),
('00000000-0000-0000-0000-000000000001', (SELECT id FROM customers WHERE name = 'Sthuthamagade Trading and Projects Cc' LIMIT 1), '20202599', '2025-07-16', '2025-07-30', 910.00, 136.50, 1046.50, 1046.50, 0.00, 'Paid in full', '2025-07-16 00:00:00+00', now()),
('00000000-0000-0000-0000-000000000001', (SELECT id FROM customers WHERE name = 'NATHAN N NYANGUWO MEDICAL ORTHOTIST AND PROSTHETIST' LIMIT 1), '20202598', '2025-06-27', '2025-07-11', 4257.52, 638.63, 4896.15, 4896.15, 0.00, 'Paid in full', '2025-06-27 00:00:00+00', now()),
('00000000-0000-0000-0000-000000000001', (SELECT id FROM customers WHERE name = 'JAMA KAMNISI TRADING AND PROJECTS' LIMIT 1), '20202597', '2025-06-27', '2025-07-11', 800.00, 120.00, 920.00, 930.00, -10.00, 'Overpaid', '2025-06-27 00:00:00+00', now()),
('00000000-0000-0000-0000-000000000001', (SELECT id FROM customers WHERE name = 'Chulumanco Lilitha' LIMIT 1), '20202596', '2025-06-27', '2025-07-11', 605.00, 90.75, 695.75, 695.75, 0.00, 'Paid in full', '2025-06-27 00:00:00+00', now()),
('00000000-0000-0000-0000-000000000001', (SELECT id FROM customers WHERE name = 'TECHLOGIX' LIMIT 1), '20202595', '2025-06-20', '2025-07-04', 2590.00, 388.50, 2978.50, 0.00, 2978.50, 'Overdue', '2025-06-20 00:00:00+00', now()),
('00000000-0000-0000-0000-000000000001', (SELECT id FROM customers WHERE name = 'JAMA KAMNISI TRADING AND PROJECTS' LIMIT 1), '20202594', '2025-06-03', '2025-06-17', 300.00, 45.00, 345.00, 0.00, 345.00, 'Overdue', '2025-06-03 00:00:00+00', now()),
('00000000-0000-0000-0000-000000000001', (SELECT id FROM customers WHERE name = 'Global Business Solutions' LIMIT 1), '20202592', '2025-05-29', '2025-06-12', 7097.57, 1065.13, 8162.70, 8000.00, 162.70, 'Overdue', '2025-05-29 00:00:00+00', now()),
('00000000-0000-0000-0000-000000000001', (SELECT id FROM customers WHERE name = 'Global Business Solutions' LIMIT 1), '20202589', '2025-05-20', '2025-06-03', 5000.00, 750.00, 5750.00, 0.00, 5750.00, 'Overdue', '2025-05-20 00:00:00+00', now()),
('00000000-0000-0000-0000-000000000001', (SELECT id FROM customers WHERE name = 'Global Business Solutions' LIMIT 1), '20202590', '2025-05-12', '2025-05-26', 21378.43, 3206.27, 24584.70, 12285.35, 12299.35, 'Overdue', '2025-05-12 00:00:00+00', now()),
('00000000-0000-0000-0000-000000000001', (SELECT id FROM customers WHERE name = 'Sembo Collective' LIMIT 1), '20202593', '2025-04-03', '2025-04-17', 990.00, 148.50, 1138.50, 1138.50, 0.00, 'Paid in full', '2025-04-03 00:00:00+00', now()),
('00000000-0000-0000-0000-000000000001', (SELECT id FROM customers WHERE name = 'Suzan Ramapulane' LIMIT 1), '20202588', '2025-03-25', '2025-04-08', 7906.57, 1186.48, 9093.05, 7471.19, 1621.86, 'Overdue', '2025-03-25 00:00:00+00', now()),
('00000000-0000-0000-0000-000000000001', (SELECT id FROM customers WHERE name = 'JAMA KAMNISI TRADING AND PROJECTS' LIMIT 1), '20202605', '2025-03-13', '2025-03-27', 1250.00, 187.50, 1437.50, -1888.41, 3325.91, 'Overdue', '2025-03-13 00:00:00+00', now()),
('00000000-0000-0000-0000-000000000001', (SELECT id FROM customers WHERE name = 'THE NEW ST SAMPSON APOSTOLIC CHURCH' LIMIT 1), '20202587', '2025-03-11', '2025-03-25', 575.00, 86.25, 661.25, 0.00, 661.25, 'Overdue', '2025-03-11 00:00:00+00', now()),
('00000000-0000-0000-0000-000000000001', (SELECT id FROM customers WHERE name = 'THOKOZA NHLANHLA INVESTMENTS' LIMIT 1), '20202586', '2025-03-03', '2025-03-17', 2540.00, 381.00, 2921.00, 0.00, 2921.00, 'Overdue', '2025-03-03 00:00:00+00', now()),
('00000000-0000-0000-0000-000000000001', (SELECT id FROM customers WHERE name = 'PRETTY HOPE SMITH' LIMIT 1), '20202585', '2025-03-03', '2025-03-17', 100.00, 15.00, 115.00, 115.00, 0.00, 'Paid in full', '2025-03-03 00:00:00+00', now()),
('00000000-0000-0000-0000-000000000001', (SELECT id FROM customers WHERE name = 'JAMA KAMNISI TRADING AND PROJECTS' LIMIT 1), '20202584', '2025-03-02', '2025-03-16', 100.00, 15.00, 115.00, 100.00, 15.00, 'Overdue', '2025-03-02 00:00:00+00', now()),
('00000000-0000-0000-0000-000000000001', (SELECT id FROM customers WHERE name = 'SSL PROJECTS AND SUPPLY' LIMIT 1), '20202591', '2025-05-28', '2025-06-11', 590.00, 88.50, 678.50, -135.70, 814.20, 'Overdue', '2025-05-28 00:00:00+00', now());

-- Update customer_id for invoices where customer lookup might have failed
UPDATE public.sales_invoices 
SET customer_id = (SELECT id FROM customers WHERE name = 'NTANDOSE TRADING AND PROJECTS' LIMIT 1) 
WHERE invoice_number = '20202583';

UPDATE public.sales_invoices 
SET customer_id = (SELECT id FROM customers WHERE name = 'THOKOZA NHLANHLA INVESTMENTS' LIMIT 1) 
WHERE invoice_number = '20202582';

-- Add more invoices that were in the data
INSERT INTO public.sales_invoices (
    user_id, 
    customer_id, 
    invoice_number, 
    issue_date, 
    due_date, 
    subtotal, 
    vat_amount, 
    total_amount, 
    amount_paid,
    balance_due,
    status,
    created_at, 
    updated_at
) VALUES
('00000000-0000-0000-0000-000000000001', (SELECT id FROM customers WHERE name = 'NTANDOSE TRADING AND PROJECTS' LIMIT 1), '20202583', '2025-02-28', '2025-03-14', 869.56, 130.43, 999.99, 999.99, 0.00, 'Paid in full', '2025-02-28 00:00:00+00', now()),
('00000000-0000-0000-0000-000000000001', (SELECT id FROM customers WHERE name = 'THOKOZA NHLANHLA INVESTMENTS' LIMIT 1), '20202582', '2025-02-28', '2025-03-14', 1240.00, 186.00, 1426.00, 1426.00, 0.00, 'Paid in full', '2025-02-28 00:00:00+00', now()),
('00000000-0000-0000-0000-000000000001', (SELECT id FROM customers WHERE name = 'JAMA KAMNISI TRADING AND PROJECTS' LIMIT 1), '20202581', '2025-02-24', '2025-03-10', 582.17, 87.33, 669.50, 2769.93, -2100.43, 'Overpaid', '2025-02-24 00:00:00+00', now()),
('00000000-0000-0000-0000-000000000001', (SELECT id FROM customers WHERE name = 'Chulumanco Lilitha' LIMIT 1), '20202580', '2025-02-20', '2025-03-06', 869.57, 130.43, 1000.00, 1000.00, 0.00, 'Paid in full', '2025-02-20 00:00:00+00', now()),
('00000000-0000-0000-0000-000000000001', (SELECT id FROM customers WHERE name = 'YOWGATY' LIMIT 1), '20202579', '2025-02-17', '2025-03-03', 426.09, 63.91, 490.00, 49.20, 440.80, 'Overdue', '2025-02-17 00:00:00+00', now()),
('00000000-0000-0000-0000-000000000001', (SELECT id FROM customers WHERE name = 'Chulumanco Lilitha' LIMIT 1), '20202578', '2025-02-10', '2025-02-24', 869.57, 130.43, 1000.00, 1150.00, -150.00, 'Overpaid', '2025-02-10 00:00:00+00', now()),
('00000000-0000-0000-0000-000000000001', (SELECT id FROM customers WHERE name = 'SIPHALI' LIMIT 1), '20202577', '2025-01-30', '2025-02-13', 1806.09, 271.91, 2078.00, 2389.70, -311.70, 'Overpaid', '2025-01-30 00:00:00+00', now()),
('00000000-0000-0000-0000-000000000001', (SELECT id FROM customers WHERE name = 'Chulumanco Lilitha' LIMIT 1), '20202576', '2025-01-28', '2025-02-11', 1206.07, 181.91, 1387.98, 650.00, 737.98, 'Overdue', '2025-01-28 00:00:00+00', now()),
('00000000-0000-0000-0000-000000000001', (SELECT id FROM customers WHERE name = 'ORIS POULTRY AND GENERAL TRADING' LIMIT 1), '20202575', '2025-01-17', '2025-01-31', 1190.43, 178.57, 1369.00, 1369.00, 0.00, 'Paid in full', '2025-01-17 00:00:00+00', now()),
('00000000-0000-0000-0000-000000000001', (SELECT id FROM customers WHERE name = 'MDALUKWANE PROJECTS ENTERPRISE' LIMIT 1), '20202574', '2025-01-08', '2025-01-22', 426.09, 63.91, 490.00, 563.50, -73.50, 'Overpaid', '2025-01-08 00:00:00+00', now()),
('00000000-0000-0000-0000-000000000001', (SELECT id FROM customers WHERE name = 'NSIBANDE MHURI TRADING AND PROJEC' LIMIT 1), '20202573', '2025-01-07', '2025-01-21', 304.35, 45.65, 350.00, 402.50, -52.50, 'Overpaid', '2025-01-07 00:00:00+00', now()),
('00000000-0000-0000-0000-000000000001', (SELECT id FROM customers WHERE name = 'Chulumanco Lilitha' LIMIT 1), '20202572', '2025-01-05', '2025-01-19', 503.48, 75.52, 579.00, 665.85, -86.85, 'Overpaid', '2025-01-05 00:00:00+00', now()),
('00000000-0000-0000-0000-000000000001', (SELECT id FROM customers WHERE name = 'Chulumanco Lilitha' LIMIT 1), '20202571', '2024-12-24', '2025-01-07', 869.57, 130.43, 1000.00, 1150.00, -150.00, 'Overpaid', '2024-12-24 00:00:00+00', now()),
('00000000-0000-0000-0000-000000000001', (SELECT id FROM customers WHERE name = 'Surprise Tuckshop & General' LIMIT 1), '20202570', '2024-11-27', '2024-12-11', 412.17, 61.83, 474.00, 345.86, 128.14, 'Overdue', '2024-11-27 00:00:00+00', now()),
('00000000-0000-0000-0000-000000000001', (SELECT id FROM customers WHERE name = 'AZALE COMMUNICATIONS (PTY) LTD' LIMIT 1), '20202569', '2024-11-22', '2024-12-06', 2826.09, 423.91, 3250.00, 3250.00, 0.00, 'Paid in full', '2024-11-22 00:00:00+00', now()),
('00000000-0000-0000-0000-000000000001', (SELECT id FROM customers WHERE name = 'Refithile Agency' LIMIT 1), '20202568', '2024-11-18', '2024-12-02', 730.43, 109.57, 840.00, 840.00, 0.00, 'Paid in full', '2024-11-18 00:00:00+00', now()),
('00000000-0000-0000-0000-000000000001', (SELECT id FROM customers WHERE name = 'Refithile Agency' LIMIT 1), '20202567', '2024-11-18', '2024-12-02', 573.91, 86.09, 660.00, 660.00, 0.00, 'Paid in full', '2024-11-18 00:00:00+00', now());